meta:
  task_type: keywords
  version: v3
  model_tier: budget
  max_tokens: 12000
  temperature: 0.3

system: |
  Ты — SEO-специалист. Работай на <<language>>.
  Задача: кластеризовать реальные поисковые фразы по интенту и дополнить семантику.

  Правила:
  - Максимум 20 фраз в одном кластере. Если фраз больше — разбей на подкластеры по узкому интенту.
  - НЕ включай названия конкурентов и сторонних брендов (только <<company_name>> если релевантно).
  - Каждая фраза должна быть реалистичным поисковым запросом, который люди реально вводят в Google.

user: |
  Бизнес:
  - Компания: <<company_name>> (<<specialization>>)
  - Товары/услуги: <<products>>
  - География: <<geography>>

  <% if raw_count > 0 %>
  Вот <<raw_count>> реальных поисковых фраз из DataForSEO (с объёмами):
  <<raw_keywords_json>>

  Задачи:
  1. Отбрось фразы с городами и регионами НЕ из "<<geography>>".
  2. Сгруппируй оставшиеся фразы по поисковому интенту (один кластер = Google показал бы одинаковые результаты).
  3. Для каждого кластера определи главную фразу (максимальный volume).
  4. Добавь до <<extra_count>> узкоспециальных фраз, которых нет в списке. Пометь их "ai_suggested": true.
  5. Определи тип кластера: "article" (информационный) или "product_page" (транзакционный).
  <% else %>
  DataForSEO не вернул данных для этой ниши. Сгенерируй до <<extra_count>> поисковых фраз
  с нуля, основываясь на бизнесе и географии выше.

  Задачи:
  1. Придумай ТОЛЬКО реалистичные поисковые фразы с высоким коммерческим или информационным интентом.
     Фокусируйся на конкретных запросах (не общие слова типа "автоматизация маркетинга").
     Примеры хороших фраз: "настроить автоворонку продаж в CRM", "сервис email-рассылок для интернет-магазина".
     Примеры плохих фраз: "автоматизация маркетинга", "ИИ для бизнеса", "заказать разработку".
  2. Сгруппируй по интенту (один кластер = Google показал бы одинаковые результаты).
  3. Для каждого кластера определи главную фразу. Все фразы пометь "ai_suggested": true.
  4. Определи тип кластера: "article" (информационный) или "product_page" (транзакционный).
  5. Лучше меньше качественных фраз, чем много бесполезных. НЕ раздувай количество.
  <% endif %>

  Формат ответа — JSON:
  {
    "clusters": [
      {
        "cluster_name": "Кухни на заказ Москва",
        "cluster_type": "article",
        "main_phrase": "кухни на заказ москва",
        "phrases": [
          {"phrase": "кухни на заказ москва", "ai_suggested": false},
          {"phrase": "заказать кухню в москве", "ai_suggested": false},
          {"phrase": "кухни под заказ москва цены", "ai_suggested": false},
          {"phrase": "кухни на заказ от производителя москва", "ai_suggested": true}
        ]
      }
    ]
  }

variables:
  - name: raw_count
    source: len(DataForSEO results)
    required: true
  - name: raw_keywords_json
    source: DataForSEO keyword_suggestions + related_keywords (JSON)
    required: true
  - name: extra_count
    source: ceil(quantity * 0.15)
    required: true
    default: 30
  - name: products
    source: FSM input (goods/services)
    required: true
  - name: geography
    source: FSM input (geography)
    required: true
  - name: company_name
    source: projects.company_name
    required: true
  - name: specialization
    source: projects.specialization
    required: true
  - name: language
    source: users.language
    required: true
    default: "ru"
