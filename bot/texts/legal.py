"""Privacy policy and terms of service texts (Russian, HTML formatting).

152-FZ compliant privacy policy with cross-border disclosure (Art. 12).
Public offer (oferta) for token-based AI content generation service.

Placeholders: [IP_FIO], [INN], [EMAIL], [DATE] — replace before production.
"""

# Maximum Telegram message length
_TG_MSG_LIMIT = 4096


def split_message(text: str, limit: int = _TG_MSG_LIMIT) -> list[str]:
    """Split long text into chunks that fit Telegram message limit.

    Splits on double-newline boundaries to keep paragraphs intact.
    Falls back to single-newline, then hard cut if a paragraph exceeds the limit.
    """
    if len(text) <= limit:
        return [text]

    chunks: list[str] = []
    remaining = text

    while remaining:
        if len(remaining) <= limit:
            chunks.append(remaining)
            break

        # Try to split on double newline
        cut_pos = remaining.rfind("\n\n", 0, limit)
        if cut_pos > 0:
            chunks.append(remaining[:cut_pos])
            remaining = remaining[cut_pos + 2 :]
            continue

        # Fallback: split on single newline
        cut_pos = remaining.rfind("\n", 0, limit)
        if cut_pos > 0:
            chunks.append(remaining[:cut_pos])
            remaining = remaining[cut_pos + 1 :]
            continue

        # Hard cut (should not happen with well-structured text)
        chunks.append(remaining[:limit])
        remaining = remaining[limit:]

    return chunks


# ---------------------------------------------------------------------------
# Privacy Policy (152-FZ)
# ---------------------------------------------------------------------------

PRIVACY_POLICY = (
    "<b>Политика конфиденциальности</b>\n"
    "<i>Редакция от [DATE]</i>\n\n"
    "<b>1. Общие положения</b>\n\n"
    "1.1. Настоящая Политика конфиденциальности (далее — Политика) определяет порядок "
    "обработки и защиты персональных данных пользователей бота SEO Master Bot "
    "(далее — Бот, Сервис).\n\n"
    "1.2. Оператор персональных данных: [IP_FIO], ИНН [INN], "
    "электронная почта: [EMAIL] (далее — Оператор).\n\n"
    "1.3. Используя Бот, Пользователь выражает согласие с настоящей Политикой. "
    "Если вы не согласны с условиями — прекратите использование Бота.\n\n"
    "1.4. Политика разработана в соответствии с Федеральным законом от 27.07.2006 "
    "N 152-ФЗ «О персональных данных».\n\n"
    "<b>2. Какие данные мы собираем</b>\n\n"
    "2.1. <b>Данные Telegram-аккаунта:</b> Telegram ID (числовой идентификатор), "
    "имя пользователя (username), имя, фамилия.\n\n"
    "2.2. <b>Данные платформ пользователя:</b> URL сайтов, логины и API-ключи "
    "для подключённых платформ (WordPress, Telegram-каналы, ВКонтакте, Pinterest). "
    "Эти данные хранятся в зашифрованном виде (Fernet AES-128-CBC) и используются "
    "исключительно для публикации контента по запросу пользователя.\n\n"
    "2.3. <b>Данные об использовании:</b> история генераций, расход токенов, "
    "статистика публикаций.\n\n"
    "2.4. <b>Платёжные данные:</b> информация о транзакциях Telegram Stars и "
    "платежах через ЮKassa. Оператор не хранит данные банковских карт — "
    "они обрабатываются непосредственно платёжным провайдером.\n\n"
    "<b>3. Цели обработки данных</b>\n\n"
    "3.1. Создание и управление учётной записью пользователя.\n"
    "3.2. Генерация SEO-контента (статьи, посты для социальных сетей) с "
    "использованием искусственного интеллекта.\n"
    "3.3. Публикация контента на платформах пользователя (WordPress, Telegram, "
    "ВКонтакте, Pinterest).\n"
    "3.4. Обработка платежей и учёт баланса токенов.\n"
    "3.5. Анализ сайтов пользователя (SEO-аудит, брендинг).\n"
    "3.6. Уведомления о статусе публикаций и баланса.\n"
    "3.7. Реферальная программа.\n\n"
    "<b>4. Передача данных третьим лицам (трансграничная передача, ст. 12 152-ФЗ)</b>\n\n"
    "Для оказания услуг Сервис передаёт данные следующим обработчикам:\n\n"
    "4.1. <b>OpenRouter LLC</b> (США) — маршрутизация запросов к AI-моделям. "
    "Через OpenRouter данные могут обрабатываться:\n"
    "  - Anthropic, PBC (США) — генерация текстов (Claude);\n"
    "  - DeepSeek (Китай) — генерация текстов и ключевых фраз;\n"
    "  - Google LLC (США) — генерация изображений (Gemini);\n"
    "  - OpenAI (США) — резервная генерация текстов.\n\n"
    "4.2. <b>Firecrawl</b> (США) — анализ структуры и содержания сайтов.\n\n"
    "4.3. <b>DataForSEO</b> (Украина) — получение данных о ключевых фразах "
    "(объём поиска, сложность, CPC).\n\n"
    "4.4. <b>Serper</b> (США) — получение данных поисковой выдачи.\n\n"
    "4.5. <b>Supabase Inc</b> (США) — хранение данных (база данных, файловое "
    "хранилище).\n\n"
    "4.6. <b>Upstash</b> (Турция) — кеширование данных и управление очередями "
    "задач.\n\n"
    "4.7. <b>Telegraph / Telegram</b> (ОАЭ) — предпросмотр статей перед "
    "публикацией.\n\n"
    "4.8. <b>ЮKassa</b> (Россия) — обработка платежей в рублях.\n\n"
    "Передача осуществляется на основании согласия пользователя (п. 1.3) в "
    "страны, обеспечивающие адекватную защиту прав субъектов персональных данных, "
    "либо при наличии договорных гарантий защиты данных.\n\n"
    "<b>5. Сроки хранения</b>\n\n"
    "5.1. Персональные данные хранятся до момента удаления учётной записи "
    "пользователем (команда /delete_account) или до отзыва согласия.\n\n"
    "5.2. После удаления аккаунта все персональные данные удаляются в "
    "течение 30 дней, за исключением обезличенной статистики и данных, "
    "хранение которых требуется законодательством.\n\n"
    "<b>6. Защита данных</b>\n\n"
    "6.1. Credentials платформ (пароли, API-ключи) хранятся в зашифрованном "
    "виде (Fernet, AES-128-CBC). Расшифровка происходит только в момент "
    "публикации.\n\n"
    "6.2. Соединение с базой данных защищено TLS. Доступ ограничен "
    "сервисным ключом.\n\n"
    "6.3. API-ключи сервисов хранятся в переменных окружения и не "
    "попадают в логи.\n\n"
    "<b>7. Права пользователя</b>\n\n"
    "В соответствии со ст. 14-17 152-ФЗ вы имеете право:\n\n"
    "7.1. Получить информацию об обработке ваших персональных данных.\n"
    "7.2. Потребовать уточнения, блокирования или уничтожения данных.\n"
    "7.3. Отозвать согласие на обработку, прекратив использование Бота.\n"
    "7.4. Удалить аккаунт и все связанные данные (команда /delete_account).\n"
    "7.5. Обратиться к Оператору по адресу [EMAIL].\n"
    "7.6. Обжаловать действия Оператора в Роскомнадзоре.\n\n"
    "<b>8. Изменения Политики</b>\n\n"
    "Оператор вправе изменять Политику. Актуальная версия доступна по "
    "команде /privacy. Продолжение использования Бота после изменений "
    "означает согласие с новой редакцией."
)


# ---------------------------------------------------------------------------
# Terms of Service (Public Offer / Oferta)
# ---------------------------------------------------------------------------

TERMS_OF_SERVICE = (
    "<b>Публичная оферта (пользовательское соглашение)</b>\n"
    "<i>Редакция от [DATE]</i>\n\n"
    "<b>1. Общие положения</b>\n\n"
    "1.1. Настоящий документ является публичной офертой (далее — Оферта) "
    "индивидуального предпринимателя [IP_FIO], ИНН [INN] "
    "(далее — Исполнитель) в адрес любого физического лица "
    "(далее — Пользователь).\n\n"
    "1.2. Использование бота SEO Master Bot (далее — Бот, Сервис) "
    "и/или оплата услуг является акцептом настоящей Оферты "
    "(ст. 438 ГК РФ).\n\n"
    "1.3. Оферта считается акцептованной с момента начала "
    "использования Бота или совершения первого платежа.\n\n"
    "<b>2. Предмет Оферты</b>\n\n"
    "2.1. Исполнитель предоставляет Пользователю доступ к Сервису "
    "автоматизированной генерации SEO-контента с использованием "
    "искусственного интеллекта, включая:\n"
    "  - генерацию текстов (статьи, посты для социальных сетей);\n"
    "  - генерацию изображений;\n"
    "  - анализ ключевых фраз;\n"
    "  - публикацию контента на платформах Пользователя;\n"
    "  - SEO-аудит сайтов.\n\n"
    "2.2. Доступ к функциям Сервиса предоставляется на основе "
    "внутренней валюты — токенов.\n\n"
    "<b>3. Стоимость и порядок оплаты</b>\n\n"
    "3.1. Стоимость: 1 токен = 1 рубль.\n\n"
    "3.2. Пакеты токенов:\n"
    "  - <b>Старт</b>: 500 токенов — 500 руб.\n"
    "  - <b>Стандарт</b>: 2 000 токенов — 1 600 руб.\n"
    "  - <b>Про</b>: 5 000 токенов — 3 000 руб.\n\n"
    "3.3. Оплата производится через:\n"
    "  - <b>Telegram Stars</b> — внутренняя валюта Telegram;\n"
    "  - <b>ЮKassa</b> — банковские карты, электронные кошельки.\n\n"
    "3.4. Токены зачисляются на баланс Пользователя мгновенно "
    "после подтверждения оплаты.\n\n"
    "<b>4. Приветственный бонус</b>\n\n"
    "4.1. При первом использовании Бота Пользователь получает "
    "1 500 приветственных токенов безвозмездно.\n\n"
    "4.2. Приветственные токены являются безвозмездными и "
    "невозвратными.\n\n"
    "<b>5. Расход токенов</b>\n\n"
    "5.1. Тарификация:\n"
    "  - Текстовый контент: 10 токенов за каждые 100 слов "
    "(с округлением вверх).\n"
    "  - Изображение: 30 токенов.\n"
    "  - Генерация ключевых фраз: 50-200 токенов.\n"
    "  - SEO-аудит сайта: 50 токенов.\n\n"
    "5.2. Токены списываются в момент генерации контента "
    "(до предпросмотра). В случае технической ошибки при "
    "генерации токены автоматически возвращаются на баланс.\n\n"
    "<b>6. Возврат средств</b>\n\n"
    "6.1. Использованные токены (потраченные на генерацию или "
    "публикацию контента) возврату не подлежат.\n\n"
    "6.2. Неиспользованные токены могут быть возвращены по "
    "запросу Пользователя в течение 14 (четырнадцати) дней "
    "с момента оплаты. Для возврата обратитесь по адресу "
    "[EMAIL].\n\n"
    "6.3. Приветственные бонусные токены возврату не подлежат "
    "в денежном выражении.\n\n"
    "6.4. Возврат производится тем же способом, которым была "
    "произведена оплата, в течение 10 рабочих дней.\n\n"
    "<b>7. Ответственность</b>\n\n"
    "7.1. Контент, сгенерированный искусственным интеллектом, "
    "предоставляется «как есть» (as is). Исполнитель не "
    "гарантирует:\n"
    "  - конкретных позиций в поисковой выдаче;\n"
    "  - определённого объёма трафика;\n"
    "  - коммерческой эффективности контента.\n\n"
    "7.2. Пользователь несёт ответственность за:\n"
    "  - проверку сгенерированного контента перед публикацией;\n"
    "  - соответствие контента законодательству РФ;\n"
    "  - корректность предоставленных данных для подключения "
    "платформ.\n\n"
    "7.3. Исполнитель не несёт ответственности за:\n"
    "  - убытки, связанные с использованием сгенерированного "
    "контента;\n"
    "  - недоступность Бота по причинам, не зависящим от "
    "Исполнителя (сбои Telegram, API-провайдеров);\n"
    "  - действия третьих лиц (AI-провайдеров, платёжных "
    "систем).\n\n"
    "<b>8. Интеллектуальная собственность</b>\n\n"
    "8.1. Сгенерированный контент принадлежит Пользователю "
    "с момента генерации. Пользователь вправе использовать "
    "его без ограничений.\n\n"
    "8.2. Права на Бот, его код, дизайн и алгоритмы "
    "принадлежат Исполнителю.\n\n"
    "<b>9. Прочие условия</b>\n\n"
    "9.1. Оферта действует бессрочно с момента публикации.\n\n"
    "9.2. Исполнитель вправе изменять условия Оферты. "
    "Актуальная версия доступна по команде /terms. "
    "Продолжение использования Бота после изменений означает "
    "согласие с новой редакцией.\n\n"
    "9.3. Споры разрешаются путём переговоров, при "
    "недостижении согласия — в суде по месту нахождения "
    "Исполнителя в соответствии с законодательством РФ.\n\n"
    "9.4. Связь с Исполнителем: [EMAIL]."
)

# Pre-computed chunks for sending via Telegram
PRIVACY_POLICY_CHUNKS: list[str] = split_message(PRIVACY_POLICY)
TERMS_OF_SERVICE_CHUNKS: list[str] = split_message(TERMS_OF_SERVICE)

# Consent notice for /start (shown until user accepts)
LEGAL_NOTICE = (
    "Для использования бота необходимо принять "
    "политику конфиденциальности и оферту.\n\n"
    "Ознакомьтесь с документами и нажмите «Принимаю»:"
)
