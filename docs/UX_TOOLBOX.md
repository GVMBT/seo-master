# UX Specification: Toolbox

> **Версия:** 1.0
> **Дата:** 2026-02-17
> **Назначение:** Полная UX-спецификация Toolbox — управление данными (проекты, категории, подключения, настройки).
> **Парный документ:** [UX_PIPELINE.md](UX_PIPELINE.md) — Pipeline-воронка публикации контента.

---

## 1. Обзор

Toolbox — режим для power users. Вход через `[Мои проекты]` на Dashboard. Назначение — управление данными: проекты, категории, подключения платформ, ключевые фразы, настройки контента, планировщик.

**Публикация контента — ТОЛЬКО через Pipeline** (см. UX_PIPELINE.md). Toolbox не содержит кнопок публикации.

---

## 2. Список проектов

### 2.1. Пустой список

```
"У вас пока нет проектов.
 Создайте первый — это займёт 30 секунд."

[Создать проект] ← SUCCESS
[Главное меню]
```

callback_data: `project:create`, `nav:dashboard`

### 2.2. Список с проектами

Только названия, без сайта и статистики. Пагинация PAGE_SIZE=8.

```
"Мои проекты (3):"

[Мебель Комфорт]
[Стоматология Улыбка]
[Автосервис Гараж]

[Создать проект] ← SUCCESS
[Главное меню]
```

callback_data: `project:{id}:card`, `project:create`, `nav:dashboard`

При >8 проектов — пагинация:

```
[◀] [1/2] [▶]
```

callback_data: `page:projects:{page_num}`

### 2.3. Создание проекта (ProjectCreateFSM — 4 шага)

Используется и в Toolbox (`[Создать проект]`), и inline в Pipeline (UX_PIPELINE §4.1, шаг 1).

```
Шаг 1: {Введите название проекта}
  "Как назовём проект?
   Это внутреннее имя для вашего удобства."
  Пример: Мебель Комфорт
  Валидация: 2-100 символов

Шаг 2: {Введите название компании}
  "Как называется ваша компания?
   Будет использоваться в текстах."
  Пример: ООО Мебель Комфорт
  Валидация: 2-255 символов

Шаг 3: {Чем занимается компания?}
  "Опишите специализацию в 2-3 словах."
  Пример: мебель на заказ
  Валидация: 2-500 символов

Шаг 4: {Введите URL сайта}
  "Адрес вашего сайта (необязательно).
   Если нет сайта — напишите «нет»."
  Пример: comfort-mebel.ru
  Валидация: URL-формат или «нет»/«-»/пустая строка

→ Успех:
  "Проект «Мебель Комфорт» создан!
   Теперь подключите платформу для публикации."
  [К проекту] ← SUCCESS    [Главное меню]

→ Отмена на любом шаге:
  [Отмена] → "Создание отменено." → возврат к списку проектов
  В Pipeline: возврат на шаг 1 (выбор проекта)
```

callback_data (при inline в Pipeline): `pipeline:create_project:cancel`

---

## 3. Карточка проекта (Project Card)

### 3.1. Формат

```
"Мебель Комфорт

 comfort-mebel.ru
 WordPress, Telegram, VK
 Категорий: 3
 Публикаций: 47"

[Редактировать]    [Категории]
[Подключения]
[Статьи]           [Соцсети]
───────────────────────
[Удалить проект] ← DANGER
[К списку проектов]
```

callback_data:
- `project:{id}:edit` — редактирование
- `project:{id}:categories` — список категорий
- `project:{id}:connections` — подключения
- `project:{id}:sched_articles` — планировщик статей (WP)
- `project:{id}:sched_social` — планировщик соцсетей (TG/VK/Pinterest)
- `project:{id}:scheduler` — legacy redirect → sched_articles
- `project:{id}:delete` — удаление
- `nav:projects` — к списку

### 3.2. Header-данные

| Поле | Источник |
|------|----------|
| Название | `projects.project_name` |
| Сайт | Из `platform_connections` WHERE platform=wordpress |
| Платформы | Список уникальных `platform_connections.platform` |
| Категорий | `COUNT(categories)` WHERE project_id |
| Публикаций | `COUNT(publication_logs)` WHERE project_id |

### 3.3. Аудит

Аудит **удалён** как кнопка. Запускается автоматически при подключении WordPress (PageSpeed + Firecrawl branding + map в фоне).

---

## 4. Редактирование проекта

```
"Мебель Комфорт — Редактирование

 Название: Мебель Комфорт
 Компания: Комфорт
 Специализация: Мебель на заказ
 Сайт: comfort-mebel.ru
 Город: Москва
 Адрес: —
 Телефон: +7 (495) 123-45-67
 Email: —
 Часовой пояс: Europe/Moscow
 ..."

[Название]         [Компания]
[Специализация]    [Сайт]
[Город]            [Адрес]
[Телефон]          [Email]
[Часовой пояс]
───────────────────────
[Удалить проект] ← DANGER
[К проекту]
```

Нажатие на кнопку поля → `{Введите новое значение}` → сохранение → возврат на экран редактирования.

callback_data: `project:{id}:edit:{field}`, `project:{id}:delete`, `project:{id}:card`

---

## 5. Подключения платформ

### 5.1. Список подключений

**Правило: 1 проект = макс. 1 подключение каждого типа.** Кнопка «Добавить» скрывается для типов, у которых уже есть подключение. Для другого сайта/канала — создайте новый проект.

```text
"Подключения — Мебель Комфорт"

[comfort-mebel.ru (WordPress)]
[@comfort_channel (Telegram)]
───────────────────────
[Добавить VK]              ← показана, т.к. VK ещё не подключён
[Добавить Pinterest]       ← показана, т.к. Pinterest ещё не подключён
───────────────────────
[К проекту]
```

callback_data:
- `conn:{conn_id}:manage` — управление существующим подключением
- `conn:{project_id}:add:wordpress` — только если нет WP
- `conn:{project_id}:add:telegram` — только если нет TG
- `conn:{project_id}:add:vk` — только если нет VK
- `conn:{project_id}:add:pinterest` — только если нет Pinterest
- `project:{id}:card`

### 5.2. Управление подключением

Нажатие на подключение → экран управления:

```
"comfort-mebel.ru (WordPress)

 Статус: Активно
 Подключено: 01.02.2026

 [Удалить подключение] ← DANGER
 [К подключениям]"
```

callback_data: `conn:{conn_id}:delete`, `conn:{project_id}:list`

---

## 6. Connection Wizards

### 6.1. WordPress (3 шага)

```
ConnectWordPressFSM:
  Шаг 1: {Введите URL сайта}
    Пример: comfort-mebel.ru
    Валидация: автодобавление https://

  Шаг 2: {Введите логин WordPress}
    Пример: admin

  Шаг 3: {Введите Application Password}
    (сообщение автоматически удаляется после прочтения)

  → [Отмена] на любом шаге → возврат к подключениям

  → Проверка WP REST API
  → Успех: "Сайт подключен!" + автозапуск: Firecrawl branding + /map + PageSpeed
  → Ошибка: "Не удалось подключиться" + подсказка
```

### 6.2. Telegram (2 шага)

Мокап инструкции BotFather:

```
"Для публикации в Telegram-канал нужен бот-публикатор.
 Создайте его за 30 секунд:

 1. Откройте @BotFather → [Открыть BotFather]     ← t.me/BotFather
 2. Отправьте /newbot
 3. Придумайте имя (например: Мой Контент Бот)
 4. Скопируйте токен и вставьте сюда ↓

 Затем добавьте бота админом в ваш канал."
```

```
ConnectTelegramFSM:
  Шаг 1: {Ссылка на канал/группу}
    Формат: @channel, t.me/channel или -100XXXXXXXXXX

  Шаг 2: {Токен бота от BotFather}
    (сообщение автоматически удаляется)

  → [Отмена] на любом шаге → возврат к подключениям

  → Проверка: бот — админ канала с правом публикации
  → Глобальная уникальность: канал не подключен другим пользователем
  → Успех: "Канал подключен!"
  → Ошибка: "Бот не является администратором канала"
```

### 6.3. VK (2 шага)

```
ConnectVKFSM:
  Шаг 1: Инструкция по получению токена (vkhost.github.io)

  Шаг 2: {Вставьте токен}
    Формат: vk1.a.XXXXXXX
    (сообщение автоматически удаляется)

  → [Отмена] на любом шаге → возврат к подключениям

  → Проверка токена через VK API
  → Показ профиля + список групп:
    [Личная страница: Иван Петров]
    [Группа: Мебель Комфорт (1500 участников)]
    → Одно нажатие = 1 запись в platform_connections

  → Успех: "VK подключен! Группа: Мебель Комфорт"
```

### 6.4. Pinterest (OAuth)

Мокап OAuth:

```
ConnectPinterestFSM:
  Шаг 1: [Авторизоваться в Pinterest] → открывает браузер
           ┌─────────────────────────────┐
           │ Pinterest OAuth             │
           │                             │
           │ SEO Master Bot requests     │
           │ access to your account      │
           │                             │
           │ [Allow]  [Deny]             │
           └─────────────────────────────┘

  Шаг 2: Автоматический возврат в бота

  Шаг 3: Выбор досок:
    [Мебельные идеи]  [Интерьеры]  [DIY проекты]
    Одна доска = одно подключение.

  → Успех: "Pinterest подключен! Доска: Мебельные идеи"
```

---

## 7. Список категорий

### 7.1. Пустой список

```
"В проекте пока нет категорий.
 Категория = тема контента (напр. «Кухонная мебель»).
 Создайте первую."

[Создать категорию] ← SUCCESS
[К проекту]
```

### 7.2. Список с категориями

Только названия (как проекты). Пагинация PAGE_SIZE=8.

```
"Категории — Мебель Комфорт (3):"

[Кухонная мебель]
[Шкафы-купе]
[Мягкая мебель]

[Создать категорию] ← SUCCESS
[К проекту]
```

callback_data: `category:{id}:card`, `category:{project_id}:create`, `project:{id}:card`

### 7.3. Создание категории (CategoryCreateFSM — 1 шаг)

Используется и в Toolbox (`[Создать категорию]`), и inline в Pipeline (UX_PIPELINE §4.1, шаг 3).

```
{Введите название категории}
  "Категория = тема контента.
   Например: «Кухонная мебель», «Услуги стоматологии»."
  Валидация: 2-100 символов

→ Успех:
  "Категория «Кухонная мебель» создана!
   Добавьте ключевые фразы для SEO-оптимизации."
  [К категории] ← SUCCESS

→ Отмена:
  [Отмена] → возврат к списку категорий
  В Pipeline: возврат на шаг 3 (выбор категории)
```

callback_data: `category:{project_id}:create:confirm`

---

## 8. Карточка категории (Category Card)

```
"Кухонная мебель

 Ключевые фразы: 12 кластеров (100 фраз)
 Описание: заполнено
 Цены: загружен прайс
 Изображения: 4 AI (стиль: фотореализм)"

[Ключевые фразы]      [Описание]
[Цены]                 [Настройки контента]
───────────────────────
[Удалить категорию] ← DANGER
[К списку категорий]
```

callback_data:
- `category:{id}:keywords` — ключевые фразы
- `category:{id}:description` — описание
- `category:{id}:prices` — цены
- `category:{id}:content_settings` — настройки контента
- `category:{id}:delete` — удаление
- `project:{project_id}:categories` — к списку

---

## 9. Ключевые фразы

### 9.1. Пустой экран

```
"Ключевые фразы — Кухонная мебель

 Фраз пока нет. Подберите для SEO-оптимизации."

[Начать подбор]
[Загрузить свои фразы]
[К категории]
```

callback_data: `kw:{cat_id}:generate`, `kw:{cat_id}:upload`, `category:{id}:card`

### 9.2. Сводка по кластерам

```
"12 кластеров (100 фраз). Лучшие по перспективности:

 «Кухни из массива» — 18 фраз, 14 200/мес, сл. 28 ★
 «Кухни на заказ» — 15 фраз, 22 800/мес, сл. 42
 «Кухонные гарнитуры» — 12 фраз, 8 600/мес, сл. 35
 ... ещё 9 кластеров

 ★ = легко попасть в ТОП (низкая сложность)"

[Посмотреть кластеры]        → постраничный список
[Скачать все (CSV)]
[Добавить ещё фразы]         → генерация
[Загрузить свои фразы]       → upload
[Удалить кластер]            → список с [X]
[Удалить все фразы]          → подтверждение
[К категории]
```

callback_data: `kw:{cat_id}:clusters`, `kw:{cat_id}:download`, `kw:{cat_id}:generate`, `kw:{cat_id}:upload`, `kw:{cat_id}:delete_cluster`, `kw:{cat_id}:delete_all`

### 9.3. Список кластеров (drill-down)

Постранично по 8:

```
«Кухни из массива» (18 фраз, 14 200/мес) [▶]
«Кухни на заказ» (15 фраз, 22 800/мес) [▶]
«Кухонные гарнитуры» (12 фраз, 8 600/мес) [▶]
...

[◀] [1/3] [▶]
[К ключевым фразам]
```

callback_data: `kw:cluster:{cluster_idx}:view`, `page:clusters:{page}`

### 9.4. Фразы кластера (drill-down)

Фразы выводятся **текстом** (не кнопками):

```
"Кластер «Кухни из массива»
 Тип: article + social | Фраз: 18 | Объём: 14 200/мес | Сложность: 28
 Главная фраза: «кухня из массива дерева»

 1. «кухня из массива дерева» — 3 200/мес, сл. 22 (главная)
 2. «кухня массив дуб» — 1 800/мес, сл. 25
 3. «кухня из дерева на заказ» — 1 400/мес, сл. 30
 ..."

[Удалить фразы]       → список с [X]
[◀] [1/3] [▶]
[К списку кластеров]
```

### 9.5. Подбор ключевых фраз (FSM)

```
KeywordGenerationFSM:
  Вопрос 1: {Какие товары/услуги?}
  Вопрос 2: {Где работаете географически?}

  Если были сохранённые ответы:
    [Использовать сохранённые]  [Пройти заново]

  ВЫБОР КОЛИЧЕСТВА:
    [50 фраз — 50 токенов]
    [100 фраз — 100 токенов]
    [150 фраз — 150 токенов]
    [200 фраз — 200 токенов]

  → Прогресс:
    "Собираем фразы из DataForSEO..."
    "Кластеризуем с помощью AI..."
    "Обогащаем данными поиска..."

  → Результат: сводка по кластерам
```

### 9.6. Загрузка своих фраз

```
KeywordUploadFSM:
  "Загрузите TXT-файл (UTF-8), одна фраза на строку.
   Макс. 500 фраз, 1 МБ."

  → Валидация файла
  → "Обогащаю данными DataForSEO..." (~3 сек)
  → "Группирую по интенту..." (~10 сек)
  → "Загружено: 12 кластеров (87 фраз).
     Добавлены объёмы и сложность."
```

### 9.7. Удаление

Удаление фраз — постраничный список с [X], без подтверждения. Если в кластере 0 фраз — кластер удаляется автоматически.

Удаление всех фраз — подтверждение в 2 шага.

---

## 10. Описание категории

```
"Описание — Кухонная мебель

 Текущее описание:
 «Производство кухонь на заказ из массива дерева.
  Индивидуальный дизайн, замер, доставка и установка.»"

[Сгенерировать AI (20 токенов)]
[Написать вручную]
[Удалить описание] ← DANGER
[К категории]
```

callback_data: `desc:{cat_id}:generate`, `desc:{cat_id}:manual`, `desc:{cat_id}:delete`, `category:{id}:card`

### 10.1. AI-генерация

```
"Сгенерировать описание для «Кухонная мебель»?
 Стоимость: 20 токенов. Баланс: 2 450."

[Да, сгенерировать] ← SUCCESS    [Отмена]

→ AI генерирует →

"Описание сгенерировано (списано 20 токенов):
 «Производство кухонь на заказ из массива дерева...»"

[Сохранить] ← SUCCESS    [Перегенерировать]    [Отмена]
```

### 10.2. Ручной ввод

```
"Введите описание категории (10-2000 символов):"
→ {Текст пользователя} → сохранение → возврат
```

### 10.3. Пустой экран

```
"Описание — Кухонная мебель

 Описание не заполнено. Добавьте для лучшего качества статей."

[Сгенерировать AI (20 токенов)]
[Написать вручную]
[К категории]
```

---

## 11. Цены

```
"Цены — Кухонная мебель

 Текущий прайс (5 позиций):
 • Кухня угловая «Модена» — 89 900 руб
 • Стол обеденный «Лофт» — 24 500 руб
 • Стулья «Скандинавия» (4 шт) — 19 600 руб
 ..."

[Обновить текстом]
[Загрузить Excel]
[Удалить прайс] ← DANGER
[К категории]
```

callback_data: `prices:{cat_id}:text`, `prices:{cat_id}:excel`, `prices:{cat_id}:delete`, `category:{id}:card`

### 11.1. Текстовый ввод

```
"Введите прайс-лист. Формат: Название — Цена
 Каждый товар с новой строки.

 Пример:
 Кухня угловая «Модена» — 89 900 руб
 Стол обеденный «Лофт» — 24 500 руб"

→ {Текст} → парсинг (разделитель " — ") → сохранение
→ Ошибка: "Не удалось распознать строку 3. Формат: Название — Цена"
```

### 11.2. Загрузка Excel

```
"Загрузите Excel-файл с прайсом.
 Формат: колонка A = название, колонка B = цена."
→ {Файл} → парсинг → сохранение
```

### 11.3. Пустой экран

```
"Цены — Кухонная мебель

 Прайс-лист не загружен. Добавьте — в статьях будут реальные цены."

[Добавить текстом]
[Загрузить Excel]
[К категории]
```

---

## 12. Настройки контента

Объединяет настройки изображений и текста в один экран.

```
"Настройки контента — Кухонная мебель

 Текст:
   Длина: 1500-2500 слов
   Стиль: Информативный

 Изображения:
   Количество: 4
   Стиль: Фотореализм"

[Длина статьи]          → {Мин. слов} + {Макс. слов}
[Стиль текста]          → множественный выбор
[Количество изображений] → 0-10
[Стиль изображений]     → выбор: Фотореализм, Аниме, Масло, Акварель...
[К категории]
```

callback_data:
- `settings:{cat_id}:text_length`
- `settings:{cat_id}:text_style`
- `settings:{cat_id}:img_count`
- `settings:{cat_id}:img_style`
- `category:{id}:card`

### 12.1. Длина статьи

```
"Текущая длина: 1500-2500 слов (~150-250 токенов)"

{Введите минимум слов}  → {Введите максимум слов}
→ Сохранение → возврат
```

### 12.2. Стиль текста

Множественный выбор (можно несколько):

```
[Рекламный]    [Мотивационный]   [Дружелюбный]
[Разговорный]  [Профессиональный] [Креативный]
[Информативный] [С юмором]
```

callback_data: `settings:{cat_id}:style:{style_name}`

### 12.3. Количество изображений

```
[0] [1] [2] [3] [4] [5] [6] [7] [8] [9] [10]
```

### 12.4. Стиль изображений

```
[Фотореализм]  [Аниме]       [Масло]
[Акварель]      [Мультяшный]  [Минимализм]
```

---

## 13. Планировщик

### 13.0. Точка входа

Карточка проекта имеет 2 кнопки планировщика:

```
[Статьи]    [Соцсети]
```

callback_data: `project:{id}:sched_articles`, `project:{id}:sched_social`

### 13.1. Расписание статей — выбор категории

```
"Статьи — Планировщик

 Выберите категорию:"

[Кухонная мебель]      → настройка расписания
[Шкафы-купе]           → настройка расписания
[Мягкая мебель]        → настройка расписания
[К проекту]
```

callback_data: `scheduler:{project_id}:cat:{cat_id}`, `project:{id}:card`

Downstream: показывает только WordPress-подключения.

### 13.2. Расписание соцсетей — выбор категории

```
"Соцсети — Планировщик

 Выберите категорию:"

[Кухонная мебель]
[Шкафы-купе]
[К проекту]
```

callback_data: `sched_social:{project_id}:cat:{cat_id}`

### 13.2.1. Соцсети — выбор подключения

```
"Соцсети — Подключения

 Выберите подключение для настройки расписания:"

[Telegram: @comfort_channel ✓]
[VK: Мебель Комфорт]
[Pinterest: comfort_pin ✓ +1 кросс]
[К категориям]
```

callback_data: `sched_social:{cat_id}:conn:{conn_id}`

### 13.2.2. Соцсети — кросс-постинг

```
"Кросс-постинг

 Ведущая платформа: Telegram (@comfort_channel)

 Выберите платформы для автоматической адаптации поста.
 Стоимость: ~10 ток/пост за кросс-пост."

[✓ VK: Мебель Комфорт]       → toggle
[  Pinterest: comfort_pin]    → toggle
[Сохранить]  [Назад]
```

callback_data: `sched_xp:{cat_id}:{conn_id}:{target_conn_id}:toggle`, `sched_xp:{cat_id}:{conn_id}:save`

При авто-публикации:
- Ведущая платформа генерирует пост
- Для каждого кросс-пост подключения: AI-адаптация (~10 ток/пост)
- Partial failure OK: ведущий пост опубликован, ошибка адаптации = рефанд за целевую платформу
- Одно уведомление со всеми результатами (ведущий + кросс-посты)

### 13.3. Настройка расписания (FSM — 3 шага)

**Пресеты** (1 клик):

```
"Быстрая настройка:"

[1 раз в неделю (Пн, 10:00)]
[3 раза в неделю (Пн, Ср, Пт)]     ← PRIMARY
[Каждый день в 10:00]
[Настроить вручную]
[Отключить расписание] ← DANGER
```

callback_data: `scheduler:preset:1w`, `scheduler:preset:3w`, `scheduler:preset:daily`, `scheduler:manual`, `scheduler:disable`

Время в пресетах — по часовому поясу пользователя (поле timezone в проекте).

**Ручная настройка:**

```
ScheduleSetupFSM:
  Шаг 1: ВЫБОР ДНЕЙ
    [Пн] [Вт] [Ср] [Чт] [Пт] [Сб] [Вс]
    (выбранные подсвечены)
    [Готово]

  Шаг 2: КОЛИЧЕСТВО ПОСТОВ В ДЕНЬ
    [1] [2] [3] [4] [5]

  Шаг 3: ВЫБОР ВРЕМЕНИ
    [06:00] [07:00] ... [23:00]
    (выбранные: зелёные, лимит: замок)

  Итог: "Расписание: Пн, Ср, Пт в 10:00. ~960 токенов/нед"
```

---

## 14. Профиль

Объединяет бывшие «Профиль» + «Настройки».

```
"Профиль

 Баланс: 2 450 токенов
 Хватит на: ~7 статей

 Статистика:
   Проектов: 3
   Публикаций: 47
   Активных расписаний: 5

 Уведомления:
   Публикации: ВКЛ
   Баланс: ВКЛ
   Новости: ВЫКЛ"

[Пополнить баланс]        → экран Токены
[Уведомления: настроить]  → переключатели
[Реферальная программа]   → ссылка + статистика
[Главное меню]
```

callback_data: `nav:tokens`, `profile:notifications`, `profile:referral`, `nav:dashboard`

### 14.1. Уведомления

```
"Уведомления

 [Публикации: ВКЛ ✓]     → toggle
 [Баланс: ВКЛ ✓]         → toggle
 [Новости: ВЫКЛ]          → toggle
 [К профилю]"
```

callback_data: `profile:notify:publications`, `profile:notify:balance`, `profile:notify:news`

### 14.2. Реферальная программа

```
"Реферальная программа

 Ваша ссылка: https://t.me/SEOMasterBot?start=ref_12345
 Приглашено: 3 человека
 Заработано: 450 бонусных токенов

 Условия: 10% от каждой покупки приглашённого."

[Поделиться]  → готовое сообщение для пересылки
[К профилю]
```

callback_data: `profile:referral:share`, `nav:profile`

---

## 15. Токены

Заменяет бывший экран «Тарифы». Пакеты токенов вместо подписок.

### 15.1. Экран покупки

```
"Токены

 Ваш баланс: 2 450 токенов

 Пакеты:
 ┌────────────┬────────┬─────────┬──────────┐
 │ Пакет      │ Токены │ Цена    │ Скидка   │
 ├────────────┼────────┼─────────┼──────────┤
 │ Старт      │ 500    │ 500 ₽   │ —        │
 │ Стандарт   │ 2 000  │ 1 600 ₽ │ −20%     │
 │ Про        │ 5 000  │ 3 000 ₽ │ −40%     │
 └────────────┴────────┴─────────┴──────────┘

 Справочник стоимости:
   Статья (2000 слов + 4 картинки): ~320 ток.
   Пост в соцсети (текст + картинка): ~40 ток.
   Подбор 100 ключевых фраз: 100 ток."

[Старт — 500 ₽]
[Стандарт — 1 600 ₽ (−20%)] ← PRIMARY
[Про — 3 000 ₽ (−40%)]
[Главное меню]
```

callback_data: `tariff:start:buy`, `tariff:standard:buy`, `tariff:pro:buy`, `nav:dashboard`

### 15.2. Выбор способа оплаты

```
"Пакет «Стандарт»
 2 000 токенов за 1 600 ₽

 Выберите способ оплаты:"

[Оплатить Stars]              → sendInvoice (currency: XTR)
[Оплатить картой (ЮKassa)]       → редирект на ЮKassa
[Назад]
```

callback_data: `tariff:standard:stars`, `tariff:standard:yookassa`, `nav:tokens`

### 15.3. Маппинг на Stars

| Пакет | Цена (руб.) | Stars (приблизительно) |
|-------|-------------|----------------------|
| Старт | 500 | ~33 Stars |
| Стандарт | 1 600 | ~104 Stars |
| Про | 3 000 | ~195 Stars |

Формула: Stars ≈ price_rub / 15.38. Источник истины — hardcoded таблица.

---

## 16. Админ-панель

Краткая секция. Видна только ADMIN_ID.

```
"Админ-панель

 Статистика:
   Пользователей: 127 (платных: 23)
   Проектов: 89
   Выручка (30 дн.): 89 000 руб

 Сервисы:
   Claude AI: работает
   Nano Banana: работает
   PostgreSQL: v17, 12 соединений"

[Мониторинг систем]     → CPU, RAM, диск
[Сообщения всем]        → выбор аудитории → текст
[Просмотр пользователя] → {user_id} → карточка пользователя
[Затраты API ($)]       → расходы за 7/30/90 дней
[Логи ошибок]           → скачивание за 24ч/7дн
[Главное меню]
```

callback_data: `admin:monitoring`, `admin:broadcast`, `admin:user_lookup`, `admin:api_costs`, `admin:logs`, `nav:dashboard`

---

## 17. ButtonStyle карта — Toolbox

### 17.1. Списки (проекты, категории)

| Кнопка | Style |
|--------|-------|
| `[Создать проект]` / `[Создать категорию]` | `SUCCESS` |
| Элементы списка | — |
| `[Главное меню]` / `[К проекту]` | — |

### 17.2. Карточки (Project Card, Category Card)

| Кнопка | Style |
|--------|-------|
| `[Редактировать]` `[Категории]` `[Подключения]` `[Планировщик]` | — |
| `[Ключевые фразы]` `[Описание]` `[Цены]` `[Настройки контента]` | — |
| `[Удалить проект]` / `[Удалить категорию]` | `DANGER` |
| `[К списку]` | — |

### 17.3. Подключения

| Кнопка | Style |
|--------|-------|
| `[Добавить WordPress/TG/VK/Pinterest]` | — |
| `[Удалить подключение]` | `DANGER` |

### 17.4. Ключевые фразы

| Кнопка | Style |
|--------|-------|
| `[Начать подбор]` `[Посмотреть кластеры]` `[Скачать]` | — |
| `[Удалить все фразы]` | `DANGER` |
| `[X]` у фразы/кластера | `DANGER` |

### 17.5. Описание / Цены

| Кнопка | Style |
|--------|-------|
| `[Сгенерировать AI]` | — |
| `[Да, сгенерировать]` (подтверждение) | `SUCCESS` |
| `[Сохранить]` | `SUCCESS` |
| `[Удалить описание]` / `[Удалить прайс]` | `DANGER` |

### 17.6. Планировщик

| Кнопка | Style |
|--------|-------|
| `[3 раза в неделю]` (рекомендуемый) | `PRIMARY` |
| Остальные пресеты | — |
| `[Настроить вручную]` | — |
| `[Отключить расписание]` | `DANGER` |

### 17.7. Токены

| Кнопка | Style |
|--------|-------|
| `[Стандарт — 1 600 ₽ (−20%)]` | `PRIMARY` |
| Остальные пакеты | — |
| `[Оплатить Stars]` / `[Оплатить картой]` | — |

### 17.8. Профиль

| Кнопка | Style |
|--------|-------|
| `[Пополнить баланс]` | `PRIMARY` |
| `[Уведомления]` `[Реферальная программа]` | — |

### 17.9. Подтверждение удаления (все экраны)

Все деструктивные действия требуют подтверждения в 2 шага: первый клик → экран подтверждения → второй клик.

| Кнопка | Style |
|--------|-------|
| `[Да, удалить]` | `DANGER` |
| `[Отмена]` | — |

#### Удаление проекта

```
"Удалить проект «Мебель Комфорт»?

 Будут удалены:
 • 3 категории со всеми фразами
 • 4 подключения платформ
 • 2 активных расписания (QStash jobs отменены)
 • 12 превью статей (токены возвращены)

 Публикации на сайте и в соцсетях НЕ удаляются.
 Это действие необратимо."

[Да, удалить проект] ← DANGER
[Отмена]
```

callback_data: `project:{id}:delete:confirm`, `project:{id}:card`

#### Удаление категории

```
"Удалить категорию «Кухонная мебель»?

 Будут удалены:
 • 12 кластеров (100 ключевых фраз)
 • Описание и прайс-лист
 • Настройки контента
 • Активные превью (токены возвращены)

 Расписания этой категории будут удалены.
 Это действие необратимо."

[Да, удалить категорию] ← DANGER
[Отмена]
```

callback_data: `category:{id}:delete:confirm`, `category:{id}:card`

#### Удаление подключения

```
"Удалить подключение «comfort-mebel.ru (WordPress)»?

 Расписания на эту платформу будут удалены.
 Публикации на сайте НЕ удаляются."

[Да, удалить] ← DANGER
[Отмена]
```

callback_data: `conn:{id}:delete:confirm`, `conn:{project_id}:list`

#### Удаление всех ключевых фраз

```
"Удалить все ключевые фразы в «Кухонная мебель»?

 12 кластеров (100 фраз) будут удалены.
 Это действие необратимо."

[Да, удалить все] ← DANGER
[Отмена]
```

callback_data: `kw:{cat_id}:delete_all:confirm`, `category:{id}:keywords`

---

## 18. Навигационная карта — Toolbox

```
[Мои проекты] (Dashboard)
 │
 ├── Список проектов (названия, PAGE_SIZE=8)
 │    ├── [Создать проект] → ProjectCreateFSM (4 шага)
 │    └── [Проект] → Карточка проекта
 │         │
 │         ├── [Редактировать] → 15 полей (кнопка на каждое)
 │         │    └── [Удалить проект] ← DANGER
 │         │
 │         ├── [Категории] → Список категорий
 │         │    ├── [Создать категорию] → CategoryCreateFSM (1 шаг)
 │         │    └── [Категория] → Карточка категории
 │         │         │
 │         │         ├── [Ключевые фразы]
 │         │         │    ├── Сводка кластеров
 │         │         │    ├── Drill-down: кластер → фразы (текстом)
 │         │         │    ├── [Начать подбор] → KeywordGenerationFSM
 │         │         │    ├── [Загрузить свои] → KeywordUploadFSM
 │         │         │    └── [Удалить кластер/все]
 │         │         │
 │         │         ├── [Описание]
 │         │         │    ├── Текущее значение
 │         │         │    ├── [AI генерация] / [Вручную]
 │         │         │    └── [Удалить]
 │         │         │
 │         │         ├── [Цены]
 │         │         │    ├── Текущий прайс
 │         │         │    ├── [Текстом] / [Excel]
 │         │         │    └── [Удалить]
 │         │         │
 │         │         ├── [Настройки контента]
 │         │         │    ├── Длина + стиль текста
 │         │         │    └── Количество + стиль изображений
 │         │         │
 │         │         └── [Удалить категорию] ← DANGER
 │         │
 │         ├── [Подключения] → Список подключений
 │         │    ├── [Добавить WP] → ConnectWordPressFSM (3 шага)
 │         │    ├── [Добавить TG] → ConnectTelegramFSM (2 шага)
 │         │    ├── [Добавить VK] → ConnectVKFSM (2 шага)
 │         │    ├── [Добавить Pinterest] → ConnectPinterestFSM (OAuth)
 │         │    └── [Удалить подключение] ← DANGER
 │         │
 │         └── [Планировщик] → Выбор категории
 │              └── [Категория] → Расписание по подключениям
 │                   ├── Пресеты (1р/нед, 3р/нед, Каждый день)
 │                   └── [Настроить вручную] → ScheduleSetupFSM (3 шага)
 │
[Профиль] (Dashboard)
 │
 ├── Баланс + статистика
 ├── [Пополнить баланс] → Токены
 ├── [Уведомления] → toggle переключатели
 └── [Реферальная программа] → ссылка + статистика

[Токены] (Dashboard)
 │
 ├── 3 пакета: Старт / Стандарт / Про
 └── [Пакет] → [Stars] / [YooKassa]
```
